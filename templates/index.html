{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="card shadow-lg">
    <div class="card-body">
        <h3 class="text-center mb-4">üìù –ú–æ–∏ –∑–∞–¥–∞—á–∏</h3>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è (—É—Å–ø–µ—Ö, –æ—à–∏–±–∫–∏, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è) -->
        {% if messages %}
        <div class="mb-3">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                <strong>
                    {% if message.tags == 'success' %}‚úÖ{% endif %}
                    {% if message.tags == 'error' %}‚ùå{% endif %}
                    {% if message.tags == 'warning' %}‚ö†Ô∏è{% endif %}
                    {% if message.tags == 'info' %}‚ÑπÔ∏è{% endif %}
                </strong>
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
        <form method="POST" class="task-form">
            {% csrf_token %}
            <div class="d-flex gap-2 mb-4">
                <input 
                    type="text" 
                    name="title" 
                    class="form-control" 
                    placeholder="‚ú® –ù–∞–ø–∏—à–∏ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É..." 
                    required
                    maxlength="200"
                >
                <input 
                    type="date" 
                    name="due_date" 
                    class="form-control" 
                    style="max-width: 200px;"
                    title="–î–∞—Ç–∞ –¥–µ–¥–ª–∞–π–Ω–∞"
                >
                <button type="submit" class="btn btn-primary">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å
                </button>
            </div>
        </form>

        <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
        <ul class="list-group">
            {% for task in tasks %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="flex-grow-1">
                    <span class="{% if task.is_completed %}task-done{% endif %}">
                        {% if task.is_completed %}‚úîÔ∏è{% else %}‚≠ï{% endif %}
                        {{ task.title }}
                    </span>
                    {% if task.due_date %}
                    <small class="text-muted ms-2">
                        üìÖ {{ task.due_date|date:"d.m.Y" }}
                        {% if task.is_overdue and not task.is_completed %}
                        <span class="badge bg-danger ms-1">‚ö†Ô∏è –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ!</span>
                        {% endif %}
                    </small>
                    {% endif %}
                </div>
                <div class="d-flex gap-2">
                    <a 
                        href="{% url 'complete_task' task.id %}" 
                        class="btn btn-sm {% if task.is_completed %}btn-secondary{% else %}btn-success{% endif %}" 
                        title="{% if task.is_completed %}–í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É{% else %}–í—ã–ø–æ–ª–Ω–µ–Ω–æ{% endif %}"
                    >
                        {% if task.is_completed %}‚Ü©Ô∏è{% else %}‚úì{% endif %}
                    </a>
                    <a 
                        href="{% url 'delete_task' task.id %}" 
                        class="btn btn-sm btn-danger" 
                        title="–£–¥–∞–ª–∏—Ç—å"
                        onclick="return confirm('üóëÔ∏è –¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É \"{{ task.title }}\"?')"
                    >
                        ‚úï
                    </a>
                </div>
            </li>
            {% empty %}
            <li class="list-group-item text-center text-muted">
                <div style="padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üòé</div>
                    <div style="font-size: 1.2rem; font-weight: 600;">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç!</div>
                    <div style="color: #9ca3af; margin-top: 0.5rem;">–û—Ç–¥—ã—Ö–∞–π –∏–ª–∏ —Å–æ–∑–¥–∞–π –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</div>
                </div>
            </li>
            {% endfor %}
        </ul>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        {% if tasks %}
        <div class="mt-4 text-center">
            <small style="display: flex; justify-content: center; gap: 2rem; flex-wrap: wrap;">
                <span>üìä <strong>–í—Å–µ–≥–æ:</strong> {{ tasks.count }}</span>
                <span>‚úÖ <strong>–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</strong> {% widthratio tasks|length tasks.count 100 %}%</span>
                <span>‚è≥ <strong>–í —Ä–∞–±–æ—Ç–µ:</strong> {{ tasks.count }}</span>
            </small>
        </div>
        {% endif %}
    </div>
</div>

<!-- Floating Action Button (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
<style>
.fab {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    font-size: 1.5rem;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    cursor: pointer;
    transition: all 0.3s ease;
    display: none; /* –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */
}

.fab:hover {
    transform: scale(1.1) rotate(90deg);
    box-shadow: 0 12px 35px rgba(102, 126, 234, 0.6);
}
</style>

{% endblock %}
